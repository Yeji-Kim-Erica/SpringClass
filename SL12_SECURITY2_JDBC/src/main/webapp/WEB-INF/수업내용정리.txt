[ìˆ˜ì—…ë‚´ìš©ì •ë¦¬] 
	
[ SL12_SECURITY2_JDBC  ***  p683   DBë¥¼ ì´ìš©í•œ ì¸ì¦ ì²˜ë¦¬ ] 


alter table member 
add constraint pk_member_id primary key(id);

ALTER TABLE MEMBER 
MODIFY (PWD VARCHAR2(100));


CREATE TABLE member_authorities
(
    username VARCHAR2(50) 
  , authority VARCHAR2(50) 
  , CONSTRAINT FK_memberauthorities_USERNAME  FOREIGN KEY(username) REFERENCES member(id)
);

// 

SeLECT * From member_authorities;

INSERT INTO  member_authorities
VALUES ( 'kenik', 'ROLE_USER');

INSERT INTO  member_authorities
VALUES ( 'admin', 'ROLE_USER');
INSERT INTO  member_authorities
VALUES ( 'admin', 'ROLE_MANAGER');
INSERT INTO  member_authorities
VALUES ( 'admin', 'ROLE_ADMIN');

COMMIT ;













------------------------------
ğŸ” Spring Security ì²˜ë¦¬ ê³¼ì • ìƒì„¸ ì„¤ëª…
1. ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œë„
ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í¼ì—ì„œ id, pwd ì…ë ¥ í›„, login-processing-urlë¡œ ìš”ì²­ì„ ë³´ëƒ„ (ì˜ˆ: /login).

Spring Securityì˜ UsernamePasswordAuthenticationFilterê°€ ìš”ì²­ì„ ê°€ë¡œì±•ë‹ˆë‹¤.

2. Authentication ê°ì²´ ìƒì„±
UsernamePasswordAuthenticationFilterëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ id, pwdë¡œ UsernamePasswordAuthenticationToken ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

java
ë³µì‚¬
í¸ì§‘
new UsernamePasswordAuthenticationToken("id", "pwd");
3. AuthenticationManager í˜¸ì¶œ
ìœ„ ì„¤ì •ì˜ <security:authentication-manager>ê°€ ì‘ë™í•˜ê³ ,

ë‚´ë¶€ì˜ <security:authentication-provider> ê°€ AuthenticationProvider ì—­í• ì„ ìˆ˜í–‰í•˜ì—¬, ì‚¬ìš©ì ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

4. JDBCë¥¼ í†µí•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
jdbc-user-serviceê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ DBë¥¼ í†µí•´ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

âœ… ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì¿¼ë¦¬:
sql
ë³µì‚¬
í¸ì§‘
SELECT id AS USERNAME, pwd AS PASSWORD, 1 as enabled FROM member WHERE id = ?
ì´ ê²°ê³¼ëŠ” org.springframework.security.core.userdetails.UserDetails ê°ì²´ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.

enabled ê°’ì´ 1ì´ì–´ì•¼ í™œì„± ì‚¬ìš©ìë¡œ ì¸ì •ë¨.

âœ… ê¶Œí•œ ì •ë³´ ì¡°íšŒ ì¿¼ë¦¬:
sql
ë³µì‚¬
í¸ì§‘
SELECT username, authority FROM member_authorities WHERE username = ?
ì˜ˆ: ('user1', 'ROLE_USER'), ('admin', 'ROLE_ADMIN')

5. ë¹„ë°€ë²ˆí˜¸ í™•ì¸ (BCryptPasswordEncoder)
ì„¤ì •ì— ë”°ë¼ bCryptPasswordEncoderë¡œ DBì˜ ë¹„ë°€ë²ˆí˜¸ì™€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¹„êµ:

java
ë³µì‚¬
í¸ì§‘
passwordEncoder.matches(rawPassword, encodedPasswordFromDB)
â— DBì— ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ BCryptë¡œ ì•”í˜¸í™”ë˜ì–´ ìˆì–´ì•¼ í•¨ (ì˜ˆ: $2a$10$...)

6. ì¸ì¦ ì„±ê³µ ì²˜ë¦¬
ì¸ì¦ì— ì„±ê³µí•˜ë©´ SecurityContextHolderì— ì¸ì¦ ê°ì²´ë¥¼ ì €ì¥í•˜ê³ ,

ì‚¬ìš©ìë¥¼ SecurityContextì— ë“±ë¡ â†’ ë¡œê·¸ì¸ ì™„ë£Œ ìƒíƒœê°€ ë©ë‹ˆë‹¤.

ì´í›„ì˜ ëª¨ë“  ìš”ì²­ì€ ì´ ì¸ì¦ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

7. ì ‘ê·¼ ì œì–´
ë¡œê·¸ì¸ í›„ ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ìš”ì²­í•˜ë©´ <security:intercept-url> ë“±ì˜ ì„¤ì •ì„ í†µí•´ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

SecurityContextHolder.getContext().getAuthentication() ì„ í†µí•´ í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ” ë¹„ë°€ë²ˆí˜¸ ì¸ì½”ë” ì„¤ì •
xml
ë³µì‚¬
í¸ì§‘
<bean id="bCryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />
Spring Security 4 ì´í›„ë¶€í„°ëŠ” ë¹„ë°€ë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ ì•”í˜¸í™” ì €ì¥ì´ ê¶Œì¥ë˜ë©°, BCryptê°€ ê°€ì¥ ì¼ë°˜ì ì…ë‹ˆë‹¤.

âœ… ìš”ì•½: ì²˜ë¦¬ íë¦„ ë„ì‹í™”
plaintext
ë³µì‚¬
í¸ì§‘
[Login Form]
    â†“ (username + password)
[UsernamePasswordAuthenticationFilter]
    â†“
[AuthenticationManager]
    â†“
[DaoAuthenticationProvider]
    â†“
[JdbcUserDetailsService]
    â†“ SQL ì‹¤í–‰ (users, authorities)
    â†“
UserDetails ìƒì„± + ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (BCrypt)
    â†“
Authentication ì„±ê³µ â†’ SecurityContext ì €ì¥
    â†“
ìš”ì²­ ë³´í˜¸ (intercept-url, @PreAuthorize ë“±ìœ¼ë¡œ ê¶Œí•œ í™•ì¸)
ğŸ” ì°¸ê³ : ì‹¤ì œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ë¬¸ì œ ì˜ˆì‹œ
ì›ì¸	ì„¤ëª…
ë¹„ë°€ë²ˆí˜¸ ì¸ì½”ë”© ë¶ˆì¼ì¹˜	DBì— ì €ì¥ëœ ì•”í˜¸í™” ë°©ì‹ì´ BCryptê°€ ì•„ë‹ ê²½ìš°
ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ	IDê°€ DBì— ì—†ê±°ë‚˜, ì¿¼ë¦¬ ì˜¤ë¥˜
enabled = 0	ê³„ì •ì´ ë¹„í™œì„± ìƒíƒœ
ê¶Œí•œ ëˆ„ë½	authorities í…Œì´ë¸”ì— ê¶Œí•œ ë¯¸ì¡´ì¬
------------------------------------------------

<security:intercept-url pattern="/customer/noticeDel.htm" access="hasRole('ROLE_USER')"  />
