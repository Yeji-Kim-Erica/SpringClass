<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page trimDirectiveWhitespaces="true" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" type="image/x-icon" href="/images/SiSt.ico">
<title>DEPT (2025. 6. 30. 오후 2:45:37)</title>
<link rel="stylesheet" href="/resources/cdn-main/example.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="/resources/cdn-main/example.js"></script>
<script src="/resources/js/dept.js"></script>
<style>
 span.material-symbols-outlined{
    vertical-align: text-bottom;
 }
</style>

<style>
   /* The Modal (background) */
   .modal {
     display: none; /* Hidden by default */
     position: fixed; /* Stay in place */
     z-index: 1; /* Sit on top */
     padding-top: 100px; /* Location of the box */
     left: 0;
     top: 0;
     width: 100%; /* Full width */
     height: 100%; /* Full height */
     overflow: auto; /* Enable scroll if needed */
     background-color: rgb(0,0,0); /* Fallback color */
     background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
   }
   
   /* Modal Content */
   .modal-content {
     position: relative;
     background-color: #fefefe;
     margin: auto;
     padding: 0;
     border: 1px solid #888;
     width: 40%;
     box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
     -webkit-animation-name: animatetop;
     -webkit-animation-duration: 0.4s;
     animation-name: animatetop;
     animation-duration: 0.4s
   }
   
   /* Add Animation */
   @-webkit-keyframes animatetop {
     from {top:-300px; opacity:0} 
     to {top:0; opacity:1}
   }
   
   @keyframes animatetop {
     from {top:-300px; opacity:0}
     to {top:0; opacity:1}
   }
   
   /* The Close Button */
   .close {
     color: white;
     float: right;
     font-size: 28px;
     font-weight: bold;
   }
   
   .close:hover,
   .close:focus {
     color: #000;
     text-decoration: none;
     cursor: pointer;
   }
   
   .modal-header {
     padding: 2px 16px;
     background-color: white;
     color: black;
   }
   
   .modal-body {padding: 2px 16px;}
   
   .modal-footer {
     padding: 2px 16px;
     background-color: gray;
     color: white;
   }
</style>


</head>
<body>
<header>
  <h1 class="main"><a href="#" style="position: absolute;top:30px;">yErica HOme</a></h1>
  <ul>
    <li><a href="#">로그인</a></li>
    <li><a href="#">회원가입</a></li>
  </ul>
</header>
<div>
  <xmp class="code"> 
        WEB-INF/views/scott/dept.jsp
  </xmp>
  
  <form action="/scott/emp" method="post">
	  <table id="tbl-dept">
	    <caption></caption>
	    <thead>
	      <tr>
	        <th></th>
	        <th>DeptNo</th>
	        <th>DName</th>
	        <th>Loc</th>
	        <th>Edit</th>
	      </tr> 
	    </thead>
	    <tbody>
	    	<c:forEach items="${list}" var="dto">
	    		<tr>
	    			<td><input type="checkbox" name="deptno" value="${dto.deptno}" data-deptno="{dto.deptno}"></td>
	    			<td>${dto.deptno}</td>
	    			<td>${dto.dname}<span class="badge right red">${dto.numberOfEmps}</span></td>
	    			<td>${dto.loc}</td>
	    			<td align="center">
	    				<span class="material-symbols-outlined delete" 
	    				data-deptno="${dtp.deptno}">close</span>
	    			</td>
	    		</tr>
	    	</c:forEach>
	    </tbody>
	    <tfoot>
	    	<tr>
	    		<td colspan="5">
	    			<button id="search" class="search" type="button">search</button>
	    			<button id="add" class="add" type="button">부서 추가</button>
	    		</td>
	    	</tr>
	    </tfoot>
	  </table>
  </form>
  
</div>

<form>
<!-- The Modal -->
<div id="add-modal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header"> 
      <h2>Ajax 부서 추가</h2>
    </div>
    <div class="modal-body">
      <div class="group">
        <label>부서번호</label>
        <input type="text" class="short" name="deptno" value="50">
       </div>
       <div class="group">
           <label>부서명</label>
           <input type="text" class="short" name="dname" value="QC">
       </div>
       <div class="group">
           <label>지역명</label>
           <input type="text" class="short" name="loc" value="SEOUL">
       </div>
       <div>
           <button id="add-dept" type="button" class="ok">확인</button>
           <button type="button" class="cancel">닫기</button>
       </div>
    </div>
    <div class="modal-footer">
      <h3>Modal Footer</h3>
    </div>
  </div> 
</div>  
</form>

<script>
	$(function() {
		// 부서추가
		var addModal = $("#add-modal");
		
		// 부서추가 모달 띄우기
		$("#add").on("click", function() {
			// addModal.css("display", "block");
			addModal.show();
			event.stopPropagation();
		});
		
		// 부서추가 모달 닫기
		$("button.cancel").on("click", function() {
			// addModal.css("display", "none");
			addModal.hide();
			event.stopPropagation();
		});
		/*
		$("body").on("click", function() {
			if (event.currentTarget != addModal) { // HtmlBodyElement 등
				addModal.hide();
			}
		});
		*/
		
		// 부서추가 모달 확인 버튼 누를 때
		$("#add-dept").on("click", function() {
			let vdetpno = $("#add-modal :text[name=deptno]").val();
			let vdname = $("#add-modal :text[name=dname]").val();
			let vloc = $("#add-modal :text[name=loc]").val();
			
			// js object
			const dept = {
					deptno : vdetpno,
					dname : vdname,
					loc : vloc
			};
			
			// dept.js -> deptService -> add() -> ajax로 부서정보 추가
			deptService.add(dept, function(result) {
				// 1. 모달창 닫기
				addModal.hide();
				// 2. 응답 메시지 처리
				if (result == 'SUCCESS') {
					 let tr = $(`
			                       <tr>
			                         <td><input type="checkbox" data-deptno="\${ vdeptno }" value="\${ vdeptno }" name="deptno"></td>
			                         <td>\${ vdetpno }</td>
			                         <td>\${ vdname }<span class="badge right red">0</span></td>
			                         <td>\${ vloc }</td>
			                         <td align="center"><span class="material-symbols-outlined delete" data-deptno="\${ vdeptno }">close</span></td>
			                       </tr>
		                       `);
					$(tr).appendTo($("table body"))
						 .find("span.delete")
						 	.on("click", function() {
									
							});
					 
				} // if
				
			}); // add
		});
		
		// 부서원 검색
		$("#search").on("click", function() {
			if (!$("tbody :checkbox:checked").length) {
				alert("부서를 체크하세요...");
				return;
			} // if
			
			$("form").submit();
		});

		
	}); // document.ready() 닫기

</script>

</body>
</html> 